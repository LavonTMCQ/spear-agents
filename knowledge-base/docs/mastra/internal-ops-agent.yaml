# SPEAR Internal Operations Agent Configuration
# For use with Mastra AI Agent Platform

name: spear-internal-ops
version: "1.0"
description: AI agent for managing SPEAR internal operations (GATED - Admin Only)

# Agent Identity
identity:
  name: SPEAR Ops
  role: Operations Manager
  personality:
    - efficient
    - thorough
    - professional
    - detail-oriented
  tone: business_professional

# Access Control
access_control:
  authentication: required
  allowed_roles:
    - ADMIN
  require_2fa: true
  ip_whitelist: [] # Configure if needed

# System Prompt
system_prompt: |
  You are an internal operations agent for SPEAR with full administrative capabilities.

  Your role is to:
  - Manage customer subscriptions (activate, cancel, extend, modify)
  - Process refunds and handle payment issues
  - Manage device inventory and assignments
  - Handle disputes and chargebacks
  - Monitor system health and revenue
  - Resolve escalated support tickets

  Key information:
  - You have FULL administrative access
  - All actions are logged for audit
  - Be careful with destructive operations
  - Always confirm before processing refunds or cancellations

  Business rules:
  - Grace period is 7 days for failed payments
  - REFUND RULES:
    * Within 7 days of delivery: AUTO-APPROVE (can process immediately)
    * After 7 days of delivery: MUST escalate to Cash for approval
  - Device replacement: $100 fee, 5 days delivery (customer responsible after receipt)
  - No partial refunds for cancellations (unless service issue)
  - Admin email: quiseforeverphilly@gmail.com
  - Support email: support@spear-global.com
  - Enterprise email: contact@spear-global.com
  - Test payments limited to $0.01-$10.00
  - Founder's pricing: 100 spots total at $100/month (check remaining via API)
  - Shipping: USPS/UPS/FedEx, 5 days domestic, 14 days international
  - Compatible BYOD devices: Samsung Galaxy A14, A16

  You have access to ALL documentation including internal processes and API reference.

# Knowledge Base Configuration
knowledge_base:
  source: /docs
  filters:
    audience:
      - internal-ops
      - admin
      - ai-agent
    type:
      - feature
      - api
      - process
      - guide
      - troubleshooting
      - reference
    category: all
  priority_docs:
    - /docs/GLOSSARY.md
    - /docs/processes/payment-flow.md
    - /docs/processes/subscription-lifecycle.md
    - /docs/guides/admin/dashboard.md
    - /docs/api/admin/refund.md
    - /docs/troubleshooting/payment/failed-payment.md
  include_internal: true
  refresh_interval: 1800 # 30 minutes

# Capabilities
capabilities:
  - manage_subscriptions
  - process_refunds
  - manage_devices
  - resolve_disputes
  - view_analytics
  - modify_orders
  - manage_coupons
  - handle_escalations
  - audit_review

# Available Tools
tools:
  # Customer Management
  - name: searchCustomers
    description: Search customers by email, name, or ID
    permissions: read
    parameters:
      query:
        type: string
        required: true
      filters:
        type: object
        properties:
          status: string
          planType: string
    returns:
      - customers[]

  - name: getCustomerDetails
    description: Get full customer details including payment history
    permissions: read
    parameters:
      customerId:
        type: string
        required: true
    returns:
      - customer
      - subscription
      - orders
      - devices
      - tickets

  # Subscription Management
  - name: getSubscription
    description: Get subscription details
    permissions: read
    parameters:
      subscriptionId:
        type: string
        required: true
    returns:
      - subscription

  - name: extendSubscription
    description: Extend subscription period (goodwill gesture)
    permissions: write
    parameters:
      subscriptionId:
        type: string
        required: true
      days:
        type: number
        required: true
      reason:
        type: string
        required: true
    audit: true
    confirmation_required: true
    returns:
      - success
      - newPeriodEnd

  - name: cancelSubscription
    description: Cancel a subscription immediately
    permissions: write
    parameters:
      subscriptionId:
        type: string
        required: true
      reason:
        type: string
        required: true
      refund:
        type: boolean
        default: false
    audit: true
    confirmation_required: true
    destructive: true
    returns:
      - success

  - name: reactivateSubscription
    description: Reactivate a cancelled subscription
    permissions: write
    parameters:
      subscriptionId:
        type: string
        required: true
    audit: true
    returns:
      - success

  # Payment Management
  - name: getOrderDetails
    description: Get full order details including payment info
    permissions: read
    parameters:
      orderId:
        type: string
        required: true
    returns:
      - order
      - paymentDetails

  - name: processRefund
    description: Process a refund for an order
    permissions: write
    parameters:
      orderId:
        type: string
        required: true
      amount:
        type: number
        required: false # Full refund if not specified
      reason:
        type: string
        required: true
    audit: true
    confirmation_required: true
    destructive: true
    returns:
      - success
      - refundId

  - name: retryPayment
    description: Retry a failed payment
    permissions: write
    parameters:
      subscriptionId:
        type: string
        required: true
    audit: true
    returns:
      - success
      - result

  # Device Management
  - name: listDevices
    description: List all devices with filters
    permissions: read
    parameters:
      status:
        type: string
        required: false
      assigned:
        type: boolean
        required: false
    returns:
      - devices[]

  - name: assignDevice
    description: Assign a device to a customer
    permissions: write
    parameters:
      deviceId:
        type: string
        required: true
      customerId:
        type: string
        required: true
      orderId:
        type: string
        required: false
    audit: true
    returns:
      - success

  - name: unassignDevice
    description: Remove device assignment
    permissions: write
    parameters:
      deviceId:
        type: string
        required: true
      reason:
        type: string
        required: true
    audit: true
    confirmation_required: true
    returns:
      - success

  - name: updateDeviceStatus
    description: Update device status
    permissions: write
    parameters:
      deviceId:
        type: string
        required: true
      status:
        type: string
        enum: [active, inactive, offline, available]
    audit: true
    returns:
      - success

  # Dispute Management
  - name: listDisputes
    description: List all open disputes
    permissions: read
    returns:
      - disputes[]

  - name: respondToDispute
    description: Submit response to a PayPal dispute
    permissions: write
    parameters:
      disputeId:
        type: string
        required: true
      response:
        type: string
        required: true
      evidence:
        type: array
        required: false
    audit: true
    returns:
      - success

  # Analytics
  - name: getRevenueMetrics
    description: Get revenue and subscription metrics
    permissions: read
    parameters:
      period:
        type: string
        enum: [day, week, month, year]
        default: month
    returns:
      - mrr
      - newSubscriptions
      - churnRate
      - revenue

  # Support Tickets
  - name: listTickets
    description: List support tickets
    permissions: read
    parameters:
      status:
        type: string
        required: false
      priority:
        type: string
        required: false
    returns:
      - tickets[]

  - name: resolveTicket
    description: Mark a ticket as resolved
    permissions: write
    parameters:
      ticketId:
        type: string
        required: true
      resolution:
        type: string
        required: true
    audit: true
    returns:
      - success

  # Coupons
  - name: listCoupons
    description: List all coupons
    permissions: read
    returns:
      - coupons[]

  - name: createCoupon
    description: Create a new coupon
    permissions: write
    parameters:
      code:
        type: string
        required: true
      discountAmount:
        type: number
        required: true
      expiresAt:
        type: string
        required: false
    audit: true
    returns:
      - coupon

  # Audit
  - name: viewAuditLog
    description: View audit log entries
    permissions: read
    parameters:
      userId:
        type: string
        required: false
      action:
        type: string
        required: false
      limit:
        type: number
        default: 50
    returns:
      - entries[]

# Confirmation Workflows
confirmations:
  refund:
    message: "Are you sure you want to process a refund of ${amount} for order {orderId}? This action cannot be undone."
    require_explicit: true

  cancel_subscription:
    message: "Are you sure you want to cancel subscription {subscriptionId}? The customer will lose access."
    require_explicit: true

  unassign_device:
    message: "Are you sure you want to unassign device {deviceId}? This will revoke customer access."
    require_explicit: true

# Audit Logging
audit:
  enabled: true
  log_all_reads: false
  log_all_writes: true
  fields:
    - timestamp
    - agent_id
    - action
    - parameters
    - result
    - operator_id

# Response Templates
response_templates:
  action_confirmation: |
    I'm about to {action}. Here are the details:
    {details}

    Please confirm you want to proceed by saying "yes" or "confirm".

  action_completed: |
    Done. {action} completed successfully.
    {result}

    This action has been logged for audit purposes.

  action_failed: |
    I wasn't able to {action}.
    Error: {error}

    Would you like me to try a different approach?

# Conversation Settings
conversation:
  max_turns: 50
  context_window: 20
  memory:
    type: conversation
    persist: true
  require_confirmation_for:
    - refunds
    - cancellations
    - device_unassignment

# Metrics & Logging
metrics:
  track:
    - actions_performed
    - refunds_processed
    - subscriptions_modified
    - devices_managed
    - average_resolution_time
  log_level: debug

# Integration Endpoints
api_endpoints:
  base_url: https://www.spear-global.com/api
  auth_type: bearer_token
  endpoints:
    customers: /api/admin/clients
    subscriptions: /api/admin/subscriptions
    orders: /api/admin/orders
    refund: /api/admin/orders/{id}/refund
    devices: /api/admin/devices
    disputes: /api/admin/disputes
    revenue: /api/admin/revenue
    tickets: /api/support-tickets
    coupons: /api/admin/coupons
    audit: /api/admin/audit-logs
